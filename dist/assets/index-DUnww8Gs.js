var ke=Object.defineProperty,Ie=Object.defineProperties;var Ee=Object.getOwnPropertyDescriptors;var ue=Object.getOwnPropertySymbols;var Se=Object.prototype.hasOwnProperty,Pe=Object.prototype.propertyIsEnumerable;var re=(s,r,a)=>r in s?ke(s,r,{enumerable:!0,configurable:!0,writable:!0,value:a}):s[r]=a,I=(s,r)=>{for(var a in r||(r={}))Se.call(r,a)&&re(s,a,r[a]);if(ue)for(var a of ue(r))Pe.call(r,a)&&re(s,a,r[a]);return s},P=(s,r)=>Ie(s,Ee(r));var Te=(s,r)=>()=>(r||s((r={exports:{}}).exports,r),r.exports);var V=(s,r,a)=>re(s,typeof r!="symbol"?r+"":r,a);var T=(s,r,a)=>new Promise((t,i)=>{var d=l=>{try{n(a.next(l))}catch(h){i(h)}},m=l=>{try{n(a.throw(l))}catch(h){i(h)}},n=l=>l.done?t(l.value):Promise.resolve(l.value).then(d,m);n((a=a.apply(s,r)).next())});import{r as b,a as Ae,b as Le}from"./vendor-Ck2WTvpr.js";import{c as Re,a as Fe,u as Oe,b as De,d as _e,P as Me}from"./redux-CiEkc1Rc.js";import{u as $e,a as qe,B as Ue,R as We,b as ae,N as Be}from"./router-BdgCWWUQ.js";var gt=Te(R=>{(function(){const r=document.createElement("link").relList;if(r&&r.supports&&r.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))t(i);new MutationObserver(i=>{for(const d of i)if(d.type==="childList")for(const m of d.addedNodes)m.tagName==="LINK"&&m.rel==="modulepreload"&&t(m)}).observe(document,{childList:!0,subtree:!0});function a(i){const d={};return i.integrity&&(d.integrity=i.integrity),i.referrerPolicy&&(d.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?d.credentials="include":i.crossOrigin==="anonymous"?d.credentials="omit":d.credentials="same-origin",d}function t(i){if(i.ep)return;i.ep=!0;const d=a(i);fetch(i.href,d)}})();var fe={exports:{}},Y={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var He=b,Ve=Symbol.for("react.element"),ze=Symbol.for("react.fragment"),Ge=Object.prototype.hasOwnProperty,Ke=He.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,Ye={key:!0,ref:!0,__self:!0,__source:!0};function ge(s,r,a){var t,i={},d=null,m=null;a!==void 0&&(d=""+a),r.key!==void 0&&(d=""+r.key),r.ref!==void 0&&(m=r.ref);for(t in r)Ge.call(r,t)&&!Ye.hasOwnProperty(t)&&(i[t]=r[t]);if(s&&s.defaultProps)for(t in r=s.defaultProps,r)i[t]===void 0&&(i[t]=r[t]);return{$$typeof:Ve,type:s,key:d,ref:m,props:i,_owner:Ke.current}}Y.Fragment=ze;Y.jsx=ge;Y.jsxs=ge;fe.exports=Y;var e=fe.exports,je,xe=Ae;je=xe.createRoot,xe.hydrateRoot;const K=s=>{const a=s>=5e4?0:5e3;return{productAmount:s,baseFee:2500,deliveryFee:a,totalAmount:s+2500+a}},ne=s=>Array.isArray(s)?s.reduce((r,a)=>r+a.product.price*a.quantity,0):0,U={currentStep:1,product:null,customer:{firstName:"",lastName:"",email:"",phone:""},creditCard:{cardNumber:"",cardHolder:"",expiryDate:"",cvv:"",cardType:null},delivery:{address:"",city:"",department:"",postalCode:"",recipientName:"",recipientPhone:""},fees:{productAmount:0,baseFee:2500,deliveryFee:5e3,totalAmount:7500},transaction:{transactionId:"",status:"pending",message:"",productNewStock:0,wompiTransactionId:"",reference:"",amount:0},loading:!1,error:null,cartItems:[],cartTotal:0},be=Re({name:"payment",initialState:U,reducers:{setCurrentStep:(s,r)=>{s.currentStep=r.payload},nextStep:s=>{s.currentStep<5&&(s.currentStep=s.currentStep+1)},previousStep:s=>{s.currentStep>1&&(s.currentStep=s.currentStep-1)},setProduct:(s,r)=>{s.product=r.payload},setCustomerInfo:(s,r)=>{s.customer=r.payload},setCreditCardInfo:(s,r)=>{s.creditCard=r.payload},setDeliveryInfo:(s,r)=>{s.delivery=r.payload},setTransactionInfo:(s,r)=>{s.transaction=r.payload},addToCart:(s,r)=>{Array.isArray(s.cartItems)||(s.cartItems=[]);const a=s.cartItems.find(t=>t.product.id===r.payload.id);a?a.quantity+=1:s.cartItems.push({product:r.payload,quantity:1}),s.cartTotal=ne(s.cartItems),s.fees=K(s.cartTotal)},removeFromCart:(s,r)=>{if(!Array.isArray(s.cartItems)){s.cartItems=[];return}s.cartItems=s.cartItems.filter(a=>a.product.id!==r.payload),s.cartTotal=ne(s.cartItems),s.fees=K(s.cartTotal)},updateCartItemQuantity:(s,r)=>{if(!Array.isArray(s.cartItems)){s.cartItems=[];return}const a=s.cartItems.find(t=>t.product.id===r.payload.productId);a&&(a.quantity=r.payload.quantity,a.quantity<=0&&(s.cartItems=s.cartItems.filter(t=>t.product.id!==r.payload.productId))),s.cartTotal=ne(s.cartItems),s.fees=K(s.cartTotal)},clearCart:s=>{s.cartItems=[],s.cartTotal=0,s.fees=K(0)},setLoading:(s,r)=>{s.loading=r.payload},setError:(s,r)=>{s.error=r.payload},resetPaymentFlow:s=>{s.currentStep=1,s.customer=U.customer,s.creditCard=U.creditCard,s.delivery=U.delivery,s.transaction=U.transaction,s.loading=!1,s.error=null},resetEverything:()=>I({},U)}}),{setCurrentStep:J,nextStep:vt,previousStep:wt,setProduct:Je,setCustomerInfo:Qe,setCreditCardInfo:Ze,setDeliveryInfo:Xe,setTransactionInfo:et,addToCart:tt,removeFromCart:oe,updateCartItemQuantity:Ne,clearCart:st,setLoading:Ct,setError:kt,resetPaymentFlow:It,resetEverything:ye}=be.actions,rt=be.reducer,ve="wompi_payment_state",ie={currentStep:1,cartItems:[],cartTotal:0,customer:{firstName:"",lastName:"",email:"",phone:""},creditCard:{cardNumber:"",cardHolder:"",expiryDate:"",cvv:"",cardType:null},delivery:{address:"",city:"",department:"",postalCode:"",recipientName:"",recipientPhone:""},fees:{productAmount:0,baseFee:2500,deliveryFee:5e3,totalAmount:7500},transaction:{transactionId:"",status:"pending",message:"",productNewStock:0,wompiTransactionId:"",reference:"",amount:0},loading:!1,error:null},at=s=>{try{const r=JSON.stringify(s);localStorage.setItem(ve,r)}catch(r){}},nt=()=>{try{const s=localStorage.getItem(ve);if(s===null)return ie;const r=JSON.parse(s);return I(I({},ie),r)}catch(s){return ie}},pe=nt(),ce=Fe({reducer:{payment:rt},preloadedState:pe?{payment:pe}:void 0,middleware:s=>s({serializableCheck:!1})});ce.subscribe(()=>{at(ce.getState().payment)});const B=()=>Oe(),Q=De,it="https://back-pasarela.onrender.com",lt={get(s){return T(this,null,function*(){const r=yield fetch(`${it}${s}`,{headers:{"ngrok-skip-browser-warning":"true"}});if(!r.ok)throw new Error(`HTTP error! status: ${r.status}`);return yield r.json()})}},le={getAllProducts(){return T(this,null,function*(){const s=yield lt.get("/api/products");if(!s.success)throw new Error(s.message||"Error al obtener los productos");return s.data})}},ot=({cardNumber:s})=>{const[r,a]=b.useState(null);return b.useEffect(()=>{const t=s.replace(/\D/g,"");if(t.length<1){a(null);return}if(t.charAt(0)==="4"){a("visa");return}if(t.length>=2){const i=parseInt(t.substring(0,2));if(i>=51&&i<=55){a("mastercard");return}}if(t.length>=4){const i=parseInt(t.substring(0,4));if(i>=2221&&i<=2720){a("mastercard");return}}if(t.length>=2){const i=parseInt(t.substring(0,2));if(i>=22&&i<=27){a("mastercard");return}}a(null)},[s]),r?e.jsxs("div",{className:"absolute right-2 top-1/2 transform -translate-y-1/2 z-30 pointer-events-none",children:[r==="visa"&&e.jsx("div",{className:"flex items-center bg-white rounded-md px-2 py-1 shadow-lg border border-gray-200",children:e.jsx("img",{src:"/visa-logo.svg",alt:"Visa",className:"h-4 w-auto",onError:t=>{t.currentTarget.style.display="none",t.currentTarget.parentElement.innerHTML='<span class="text-blue-600 font-bold text-xs">VISA</span>'}})}),r==="mastercard"&&e.jsx("div",{className:"flex items-center bg-white rounded-md px-2 py-1 shadow-lg border border-gray-200",children:e.jsx("img",{src:"/mastercard-logo.svg",alt:"Mastercard",className:"h-4 w-auto",onError:t=>{t.currentTarget.style.display="none",t.currentTarget.parentElement.innerHTML='<span class="text-red-600 font-bold text-xs">MC</span>'}})})]}):null},ct=({isOpen:s,onClose:r})=>{const a=B(),[t,i]=b.useState({firstName:"",lastName:"",email:"",phone:"",cardNumber:"",cardHolder:"",expiryDate:"",cvv:"",address:"",city:"",department:"",postalCode:"",recipientName:"",recipientPhone:""}),[d,m]=b.useState("personal"),[n,l]=b.useState({}),[h,g]=b.useState(!1),[f,o]=b.useState(null);b.useEffect(()=>{if(!t.cardNumber){o(null);return}const c=t.cardNumber.replace(/\s/g,"");c.startsWith("4")?o("visa"):c.startsWith("5")&&["1","2","3","4","5"].includes(c[1])||c.startsWith("2")&&parseInt(c.substring(0,4))>=2221&&parseInt(c.substring(0,4))<=2720?o("mastercard"):o(null)},[t.cardNumber]);const p=c=>(c.replace(/\D/g,"").match(/.{1,4}/g)||[]).join(" "),E=c=>{let u=c.replace(/\D/g,"");u.length>16&&(u=u.slice(0,16)),i(F=>P(I({},F),{cardNumber:p(u)}))},v=c=>{let u=c.replace(/\D/g,"");u.length>4&&(u=u.slice(0,4)),u.length>=2&&(u=u.slice(0,2)+"/"+u.slice(2)),i(F=>P(I({},F),{expiryDate:u}))},S=(c,u)=>{const Z=c.replace(/\D/g,"").slice(0,10);i(X=>P(I({},X),{[u]:Z}))},$=()=>{const c={};return d==="personal"?(t.firstName.trim()||(c.firstName="Nombre requerido"),t.lastName.trim()||(c.lastName="Apellido requerido"),t.email.includes("@")||(c.email="Email invÃ¡lido"),t.phone.trim()||(c.phone="TelÃ©fono requerido")):d==="card"?(t.cardNumber.replace(/\s/g,"").length!==16&&(c.cardNumber="NÃºmero de tarjeta debe tener 16 dÃ­gitos"),t.cardHolder.trim()||(c.cardHolder="Nombre del titular requerido"),t.expiryDate.length!==5&&(c.expiryDate="Fecha invÃ¡lida (MM/YY)"),t.cvv.length!==3&&(c.cvv="CVV debe tener 3 dÃ­gitos")):d==="delivery"&&(t.address.trim()||(c.address="DirecciÃ³n requerida"),t.city.trim()||(c.city="Ciudad requerida"),t.department.trim()||(c.department="Departamento requerido"),t.postalCode.trim()||(c.postalCode="CÃ³digo postal requerido"),t.recipientName.trim()||(c.recipientName="Nombre del destinatario requerido"),t.recipientPhone.trim()||(c.recipientPhone="TelÃ©fono del destinatario requerido")),l(c),Object.keys(c).length===0},A=()=>{$()&&(d==="personal"?m("card"):d==="card"?m("delivery"):_())},_=()=>T(R,null,function*(){if($()){g(!0);try{yield new Promise(c=>setTimeout(c,1e3)),a(Qe({firstName:t.firstName,lastName:t.lastName,email:t.email,phone:t.phone})),a(Ze({cardNumber:t.cardNumber,cardHolder:t.cardHolder,expiryDate:t.expiryDate,cvv:t.cvv,cardType:f})),a(Xe({address:t.address,city:t.city,department:t.department,postalCode:t.postalCode,recipientName:t.recipientName,recipientPhone:t.recipientPhone})),a(J(2)),r()}catch(c){}finally{g(!1)}}}),q=[{id:"personal",title:"Personal",icon:"ðŸ‘¤",description:"InformaciÃ³n personal"},{id:"card",title:"Tarjeta",icon:"ðŸ’³",description:"Datos de la tarjeta"},{id:"delivery",title:"Entrega",icon:"ðŸ“¦",description:"DirecciÃ³n de entrega"}];return s?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 bg-neutral-900/80 backdrop-blur-sm z-50 animate-fadeIn",onClick:r}),e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-2 sm:p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl sm:rounded-3xl shadow-strong w-full max-w-2xl max-h-[95vh] sm:max-h-[90vh] flex flex-col animate-scaleIn",children:[e.jsxs("div",{className:"relative bg-gradient-primary text-white p-4 sm:p-6 rounded-t-2xl sm:rounded-t-3xl",children:[e.jsx("button",{onClick:r,className:"absolute top-4 right-4 w-8 h-8 rounded-full hover:bg-white/20 flex items-center justify-center transition-colors",children:e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})}),e.jsxs("div",{className:"text-center",children:[e.jsx("h2",{className:"text-2xl font-bold mb-2",children:"InformaciÃ³n de Pago"}),e.jsx("p",{className:"text-primary-100",children:"Completa los datos para proceder"})]})]}),e.jsx("div",{className:"border-b border-neutral-200 bg-neutral-50",children:e.jsx("div",{className:"flex",children:q.map(c=>e.jsx("button",{onClick:()=>m(c.id),className:`flex-1 px-4 py-4 text-sm font-medium transition-colors ${d===c.id?"text-primary-600 border-b-2 border-primary-600 bg-white":"text-neutral-600 hover:text-neutral-900 hover:bg-neutral-100"}`,children:e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx("span",{className:"text-lg",children:c.icon}),e.jsxs("div",{className:"text-left",children:[e.jsx("div",{className:"font-semibold",children:c.title}),e.jsx("div",{className:"text-xs text-neutral-500",children:c.description})]})]})},c.id))})}),e.jsxs("div",{className:"flex-1 p-4 sm:p-6 overflow-y-auto",children:[d==="personal"&&e.jsxs("div",{className:"space-y-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-neutral-900 mb-4",children:"InformaciÃ³n Personal"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-neutral-700 mb-2",children:"Nombre"}),e.jsx("input",{type:"text",value:t.firstName,onChange:c=>i(u=>P(I({},u),{firstName:c.target.value})),className:`input-field ${n.firstName?"input-error":""}`,placeholder:"Tu nombre"}),n.firstName&&e.jsx("p",{className:"text-error-600 text-sm mt-1",children:n.firstName})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-neutral-700 mb-2",children:"Apellido"}),e.jsx("input",{type:"text",value:t.lastName,onChange:c=>i(u=>P(I({},u),{lastName:c.target.value})),className:`input-field ${n.lastName?"input-error":""}`,placeholder:"Tu apellido"}),n.lastName&&e.jsx("p",{className:"text-error-600 text-sm mt-1",children:n.lastName})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-neutral-700 mb-2",children:"Email"}),e.jsx("input",{type:"email",value:t.email,onChange:c=>i(u=>P(I({},u),{email:c.target.value})),className:`input-field ${n.email?"input-error":""}`,placeholder:"tu@email.com"}),n.email&&e.jsx("p",{className:"text-error-600 text-sm mt-1",children:n.email})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-neutral-700 mb-2",children:"TelÃ©fono"}),e.jsx("input",{type:"tel",value:t.phone,onChange:c=>S(c.target.value,"phone"),className:`input-field ${n.phone?"input-error":""}`,placeholder:"3001234567",maxLength:10}),n.phone&&e.jsx("p",{className:"text-error-600 text-sm mt-1",children:n.phone})]})]}),d==="card"&&e.jsxs("div",{className:"space-y-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-neutral-900 mb-4",children:"Datos de la Tarjeta"}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-neutral-700 mb-2",children:"NÃºmero de Tarjeta"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"text",value:t.cardNumber,onChange:c=>E(c.target.value),className:`input-field pr-16 ${n.cardNumber?"input-error":""}`,placeholder:"1234 5678 9012 3456",maxLength:19}),e.jsx(ot,{cardNumber:t.cardNumber})]}),n.cardNumber&&e.jsx("p",{className:"text-error-600 text-sm mt-1",children:n.cardNumber})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-neutral-700 mb-2",children:"Nombre del Titular"}),e.jsx("input",{type:"text",value:t.cardHolder,onChange:c=>i(u=>P(I({},u),{cardHolder:c.target.value.toUpperCase()})),className:`input-field ${n.cardHolder?"input-error":""}`,placeholder:"NOMBRE COMO APARECE EN LA TARJETA"}),n.cardHolder&&e.jsx("p",{className:"text-error-600 text-sm mt-1",children:n.cardHolder})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-neutral-700 mb-2",children:"Fecha de Vencimiento"}),e.jsx("input",{type:"text",value:t.expiryDate,onChange:c=>v(c.target.value),className:`input-field ${n.expiryDate?"input-error":""}`,placeholder:"MM/YY",maxLength:5}),n.expiryDate&&e.jsx("p",{className:"text-error-600 text-sm mt-1",children:n.expiryDate})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-neutral-700 mb-2",children:"CVV"}),e.jsx("input",{type:"text",value:t.cvv,onChange:c=>i(u=>P(I({},u),{cvv:c.target.value.replace(/\D/g,"").slice(0,3)})),className:`input-field ${n.cvv?"input-error":""}`,placeholder:"123",maxLength:3}),n.cvv&&e.jsx("p",{className:"text-error-600 text-sm mt-1",children:n.cvv})]})]})]}),d==="delivery"&&e.jsxs("div",{className:"space-y-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-neutral-900 mb-4",children:"InformaciÃ³n de Entrega"}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-neutral-700 mb-2",children:"DirecciÃ³n"}),e.jsx("input",{type:"text",value:t.address,onChange:c=>i(u=>P(I({},u),{address:c.target.value})),className:`input-field ${n.address?"input-error":""}`,placeholder:"Calle 123 #45-67"}),n.address&&e.jsx("p",{className:"text-error-600 text-sm mt-1",children:n.address})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-neutral-700 mb-2",children:"Ciudad"}),e.jsx("input",{type:"text",value:t.city,onChange:c=>i(u=>P(I({},u),{city:c.target.value})),className:`input-field ${n.city?"input-error":""}`,placeholder:"MedellÃ­n"}),n.city&&e.jsx("p",{className:"text-error-600 text-sm mt-1",children:n.city})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-neutral-700 mb-2",children:"Departamento"}),e.jsx("input",{type:"text",value:t.department,onChange:c=>i(u=>P(I({},u),{department:c.target.value})),className:`input-field ${n.department?"input-error":""}`,placeholder:"Antioquia"}),n.department&&e.jsx("p",{className:"text-error-600 text-sm mt-1",children:n.department})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-neutral-700 mb-2",children:"CÃ³digo Postal"}),e.jsx("input",{type:"text",value:t.postalCode,onChange:c=>i(u=>P(I({},u),{postalCode:c.target.value})),className:`input-field ${n.postalCode?"input-error":""}`,placeholder:"05001"}),n.postalCode&&e.jsx("p",{className:"text-error-600 text-sm mt-1",children:n.postalCode})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-neutral-700 mb-2",children:"Nombre del Destinatario"}),e.jsx("input",{type:"text",value:t.recipientName,onChange:c=>i(u=>P(I({},u),{recipientName:c.target.value})),className:`input-field ${n.recipientName?"input-error":""}`,placeholder:"Nombre completo"}),n.recipientName&&e.jsx("p",{className:"text-error-600 text-sm mt-1",children:n.recipientName})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-neutral-700 mb-2",children:"TelÃ©fono del Destinatario"}),e.jsx("input",{type:"tel",value:t.recipientPhone,onChange:c=>S(c.target.value,"recipientPhone"),className:`input-field ${n.recipientPhone?"input-error":""}`,placeholder:"3001234567",maxLength:10}),n.recipientPhone&&e.jsx("p",{className:"text-error-600 text-sm mt-1",children:n.recipientPhone})]})]})]})]}),e.jsx("div",{className:"flex-shrink-0 border-t border-neutral-200 p-4 sm:p-6 bg-neutral-50 rounded-b-3xl",children:e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-stretch sm:items-center gap-3 sm:gap-4",children:[e.jsx("button",{onClick:()=>{d==="personal"?r():m(d==="card"?"personal":"card")},className:"btn-outline px-6 py-3 flex-shrink-0 order-2 sm:order-1",children:d==="personal"?"Cancelar":"Anterior"}),e.jsx("button",{onClick:A,disabled:h,className:`btn-primary px-8 py-3 flex-shrink-0 order-1 sm:order-2 ${h?"opacity-50 cursor-not-allowed":""}`,children:h?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"spinner w-4 h-4"}),e.jsx("span",{children:"Procesando..."})]}):d==="delivery"?e.jsx("span",{children:"Continuar al Resumen"}):e.jsx("span",{children:"Siguiente"})})]})})]})})]}):null},dt=()=>{const s=B(),{cartItems:r,cartTotal:a,fees:t}=Q(o=>o.payment),[i,d]=b.useState(!1),[m,n]=b.useState(!1),l={baseFee:(t==null?void 0:t.baseFee)||2500,deliveryFee:(t==null?void 0:t.deliveryFee)||5e3,totalAmount:(t==null?void 0:t.totalAmount)||a+((t==null?void 0:t.baseFee)||2500)+((t==null?void 0:t.deliveryFee)||5e3),productAmount:(t==null?void 0:t.productAmount)||a},h=a||0;if(r.length===0)return null;const g=(o,p)=>{p<=0?s(oe(o)):s(Ne({productId:o,quantity:p}))},f=r.reduce((o,p)=>o+p.quantity,0);return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed bottom-6 right-6 z-50",children:e.jsx("button",{onClick:()=>d(!0),className:"bg-gradient-primary text-white rounded-2xl w-14 h-14 sm:w-16 sm:h-16 flex items-center justify-center shadow-strong hover:shadow-glow transition-all duration-300 hover:scale-110 group",children:e.jsxs("div",{className:"relative",children:[e.jsx("svg",{className:"w-6 h-6 sm:w-7 sm:h-7 group-hover:scale-110 transition-transform duration-200",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M3 3h2l.4 2M7 13h10l4-8H5.4m0 0L7 13m0 0l-1.1 5.6a1 1 0 001 1.4h9.2M7 13v6a1 1 0 001 1h8a1 1 0 001-1v-6m-9 1h10"})}),f>0&&e.jsx("span",{className:"absolute -top-2 -right-2 bg-error-500 text-white text-xs font-bold rounded-full w-5 h-5 flex items-center justify-center animate-bounce-soft",children:f>99?"99+":f})]})})}),i&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 bg-neutral-900/50 backdrop-blur-sm z-50 animate-fadeIn",onClick:()=>d(!1)}),e.jsx("div",{className:"fixed inset-y-0 right-0 z-50 w-full max-w-md bg-white shadow-strong animate-slideUp sm:animate-fadeIn",children:e.jsxs("div",{className:"flex flex-col h-full",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-neutral-200 bg-white sticky top-0 z-10",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-primary-100 rounded-2xl flex items-center justify-center",children:e.jsx("svg",{className:"w-5 h-5 text-primary-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M3 3h2l.4 2M7 13h10l4-8H5.4m0 0L7 13m0 0l-1.1 5.6a1 1 0 001 1.4h9.2M7 13v6a1 1 0 001 1h8a1 1 0 001-1v-6m-9 1h10"})})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold text-neutral-900",children:"Tu Carrito"}),e.jsxs("p",{className:"text-sm text-neutral-600",children:[r.length," producto",r.length!==1?"s":""]})]})]}),e.jsx("button",{onClick:()=>d(!1),className:"w-10 h-10 rounded-xl hover:bg-neutral-100 flex items-center justify-center transition-colors group",children:e.jsx("svg",{className:"w-5 h-5 text-neutral-600 group-hover:text-neutral-900 transition-colors",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-6",children:[e.jsx("div",{className:"space-y-4",children:r.map((o,p)=>e.jsx("div",{className:"card p-4 animate-slideUp",style:{animationDelay:`${p*100}ms`},children:e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:"w-16 h-16 bg-gradient-to-br from-primary-100 to-primary-50 rounded-xl flex items-center justify-center flex-shrink-0",children:e.jsx("span",{className:"text-2xl",children:"ðŸ“±"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{className:"font-semibold text-neutral-900 mb-1 line-clamp-2",children:o.product.name}),e.jsxs("p",{className:"text-sm text-neutral-600 mb-3",children:["$",o.product.price.toLocaleString()," c/u"]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>g(o.product.id,o.quantity-1),className:"w-7 h-7 rounded-lg bg-neutral-100 hover:bg-neutral-200 border border-neutral-200 flex items-center justify-center transition-all hover:scale-105",children:e.jsx("svg",{className:"w-3 h-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M20 12H4"})})}),e.jsx("span",{className:"font-semibold text-sm px-2 py-1 bg-primary-50 text-primary-700 rounded-lg border border-primary-200 min-w-[2rem] text-center",children:o.quantity}),e.jsx("button",{onClick:()=>g(o.product.id,o.quantity+1),disabled:o.quantity>=o.product.stock,className:`w-7 h-7 rounded-lg flex items-center justify-center transition-all hover:scale-105 ${o.quantity>=o.product.stock?"bg-neutral-100 text-neutral-400 cursor-not-allowed border border-neutral-200":"bg-primary-600 text-white hover:bg-primary-700 border border-primary-600"}`,children:e.jsx("svg",{className:"w-3 h-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4v16m8-8H4"})})})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("p",{className:"font-bold text-primary-600 mb-1",children:["$",(o.product.price*o.quantity).toLocaleString()]}),e.jsxs("button",{onClick:()=>s(oe(o.product.id)),className:"text-error-600 hover:text-error-700 text-xs flex items-center gap-1 ml-auto",children:[e.jsx("svg",{className:"w-3 h-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})}),"Eliminar"]})]})]})]})]})},o.product.id))}),r.length>1&&e.jsxs("button",{onClick:()=>s(st()),className:"w-full mt-6 py-3 text-error-600 hover:text-error-700 text-sm font-medium border border-error-200 rounded-xl hover:bg-error-50 transition-all flex items-center justify-center gap-2",children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})}),"Vaciar Carrito"]})]}),e.jsxs("div",{className:"border-t border-neutral-200 p-6 bg-neutral-50 sticky bottom-0",children:[e.jsxs("div",{className:"space-y-2 mb-6",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-neutral-600",children:"Subtotal productos:"}),e.jsxs("span",{className:"font-medium",children:["$",h.toFixed(2)]})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-neutral-600",children:"Tarifa base:"}),e.jsxs("span",{className:"font-medium",children:["$",l.baseFee.toFixed(2)]})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-neutral-600",children:"Costo de envÃ­o:"}),e.jsx("span",{className:"font-medium",children:l.deliveryFee===0?e.jsx("span",{className:"text-success-600 font-bold",children:"GRATIS"}):`$${l.deliveryFee.toFixed(2)}`})]}),e.jsx("div",{className:"border-t border-neutral-300 pt-3 mt-3",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-lg font-bold text-neutral-900",children:"Total:"}),e.jsxs("span",{className:"text-2xl font-bold text-primary-600",children:["$",l.totalAmount.toFixed(2)," COP"]})]})})]}),l.deliveryFee>0&&e.jsx("div",{className:"bg-warning-50 border border-warning-200 rounded-xl p-4 mb-4",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"text-warning-600 text-lg",children:"ðŸ’¡"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-warning-800 mb-1",children:"Â¡Casi tienes envÃ­o gratis!"}),e.jsxs("p",{className:"text-xs text-warning-700",children:["Agrega $",Math.max(0,5e4-h).toFixed(2)," mÃ¡s para envÃ­o gratuito"]})]})]})}),e.jsx("button",{onClick:()=>n(!0),disabled:r.length===0,className:`w-full py-4 px-6 rounded-xl text-lg font-semibold transition-all duration-200 transform hover:scale-[1.02] active:scale-[0.98] ${r.length===0?"bg-neutral-300 text-neutral-500 cursor-not-allowed":"bg-gradient-primary text-white shadow-soft hover:shadow-medium"}`,children:e.jsxs("div",{className:"flex items-center justify-center gap-3",children:[e.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M3 10h18M7 15h1m4 0h1m-7 4h12a3 3 0 003-3V8a3 3 0 00-3-3H6a3 3 0 00-3 3v8a3 3 0 003 3z"})}),e.jsx("span",{children:"Pagar con Tarjeta de CrÃ©dito"})]})}),e.jsx("button",{onClick:()=>d(!1),className:"w-full mt-3 py-3 px-6 rounded-xl bg-white text-neutral-600 border border-neutral-300 hover:bg-neutral-50 transition-all duration-200 font-medium",children:"Continuar Comprando"}),e.jsx("div",{className:"mt-3 text-center",children:e.jsxs("p",{className:"text-xs text-neutral-500 flex items-center justify-center gap-1",children:[e.jsx("svg",{className:"w-3 h-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"})}),"Pago seguro con Wompi"]})})]})]})})]}),e.jsx(ct,{isOpen:m,onClose:()=>n(!1)})]})},he=()=>{const s=B(),{cartItems:r}=Q(o=>o.payment),[a,t]=b.useState([]),[i,d]=b.useState(!0),[m,n]=b.useState(null);b.useEffect(()=>{T(R,null,function*(){try{d(!0);const p=yield le.getAllProducts();t(p)}catch(p){n(p.message)}finally{d(!1)}})},[]);const l=o=>{s(tt(o)),s(Je(o))},h=o=>{s(oe(o))},g=(o,p)=>{s(Ne({productId:o,quantity:p}))},f=o=>{const p=r.find(E=>E.product.id===o);return p?p.quantity:0};return i?e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-neutral-50 via-primary-50/20 to-neutral-50 flex items-center justify-center",children:e.jsxs("div",{className:"text-center animate-slideUp",children:[e.jsxs("div",{className:"relative mb-8",children:[e.jsx("div",{className:"spinner w-16 h-16 border-4 border-primary-200 border-t-primary-600 mx-auto"}),e.jsx("div",{className:"absolute inset-0 rounded-full bg-primary-100/20 animate-ping"})]}),e.jsx("h3",{className:"text-xl font-semibold text-neutral-800 mb-2",children:"Cargando productos increÃ­bles..."}),e.jsx("p",{className:"text-neutral-600",children:"Preparando la mejor selecciÃ³n para ti"})]})}):m?e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-neutral-50 via-error-50/20 to-neutral-50 flex items-center justify-center",children:e.jsxs("div",{className:"text-center animate-slideUp",children:[e.jsx("div",{className:"text-6xl mb-6",children:"ðŸ˜ž"}),e.jsx("h3",{className:"text-xl font-semibold text-neutral-800 mb-4",children:"Ups, algo saliÃ³ mal"}),e.jsx("p",{className:"text-neutral-600 mb-6 max-w-md",children:m}),e.jsxs("button",{onClick:()=>{T(R,null,function*(){try{d(!0);const p=yield le.getAllProducts();t(p)}catch(p){n(p.message)}finally{d(!1)}})},className:"btn-primary",children:[e.jsx("svg",{className:"w-5 h-5 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})}),"Reintentar"]})]})}):e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-neutral-50 via-primary-50/20 to-neutral-50",children:[e.jsxs("div",{className:"relative overflow-hidden",children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-primary-600/90 to-primary-800/90"}),e.jsx("div",{className:"absolute inset-0 bg-[url('data:image/svg+xml,%3Csvg%20width%3D%2260%22%20height%3D%2260%22%20viewBox%3D%220%200%2060%2060%22%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%3E%3Cg%20fill%3D%22none%22%20fill-rule%3D%22evenodd%22%3E%3Cg%20fill%3D%22%23ffffff%22%20fill-opacity%3D%220.05%22%3E%3Ccircle%20cx%3D%2230%22%20cy%3D%2230%22%20r%3D%222%22/%3E%3C/g%3E%3C/g%3E%3C/svg%3E')] opacity-50"}),e.jsx("div",{className:"relative container-responsive py-16 sm:py-24 lg:py-32",children:e.jsxs("div",{className:"text-center animate-slideUp",children:[e.jsx("div",{className:"text-6xl sm:text-7xl lg:text-8xl mb-6 floating",children:"ðŸ›ï¸"}),e.jsxs("h1",{className:"text-4xl sm:text-5xl lg:text-6xl font-bold text-white mb-6 leading-tight",children:["Descubre Productos",e.jsx("span",{className:"block text-gradient bg-gradient-to-r from-yellow-300 to-orange-300 bg-clip-text text-transparent",children:"Extraordinarios"})]}),e.jsx("p",{className:"text-lg sm:text-xl text-white/90 max-w-2xl mx-auto leading-relaxed",children:"TecnologÃ­a de Ãºltima generaciÃ³n, diseÃ±o excepcional y la mejor experiencia de compra"}),e.jsxs("div",{className:"flex items-center justify-center gap-8 mt-8 text-white/80",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold",children:a.length}),e.jsx("div",{className:"text-sm",children:"Productos"})]}),e.jsx("div",{className:"w-px h-8 bg-white/20"}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold",children:"4.9"}),e.jsx("div",{className:"text-sm",children:"Rating"})]}),e.jsx("div",{className:"w-px h-8 bg-white/20"}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold",children:"24/7"}),e.jsx("div",{className:"text-sm",children:"Soporte"})]})]})]})}),e.jsx("div",{className:"absolute bottom-0 left-0 right-0",children:e.jsx("svg",{className:"w-full h-12 sm:h-16 lg:h-20 text-neutral-50",preserveAspectRatio:"none",viewBox:"0 0 1200 120",xmlns:"http://www.w3.org/2000/svg",children:e.jsx("path",{d:"M0,0V60s360,60,600,0S1200,60,1200,60V0Z",className:"fill-current"})})})]}),e.jsxs("div",{className:"container-responsive py-16 sm:py-20 lg:py-24",children:[e.jsxs("div",{className:"text-center mb-12 lg:mb-16",children:[e.jsx("h2",{className:"text-3xl sm:text-4xl font-bold text-neutral-900 mb-4",children:"Nuestros Productos"}),e.jsx("p",{className:"text-lg text-neutral-600 max-w-2xl mx-auto",children:"Cada producto ha sido cuidadosamente seleccionado para brindarte la mejor experiencia"})]}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6 lg:gap-8",children:a.map((o,p)=>{const E=f(o.id),v=o.stock<=5&&o.stock>0,S=o.stock===0;return e.jsxs("div",{className:"card-interactive group animate-slideUp",style:{animationDelay:`${p*100}ms`},children:[e.jsxs("div",{className:"relative h-48 sm:h-56 bg-gradient-to-br from-primary-100 via-primary-50 to-neutral-100 rounded-t-2xl overflow-hidden",children:[e.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:e.jsx("div",{className:"text-4xl sm:text-5xl group-hover:scale-110 transition-transform duration-300",children:"ðŸ“±"})}),e.jsxs("div",{className:"absolute top-3 right-3 flex flex-col gap-2",children:[S&&e.jsx("span",{className:"badge-error",children:"Sin Stock"}),v&&e.jsxs("span",{className:"badge-warning",children:["Â¡Solo ",o.stock,"!"]}),!S&&!v&&e.jsxs("span",{className:"badge-success",children:[o.stock," disponibles"]})]}),e.jsx("div",{className:"absolute inset-0 bg-primary-600/0 group-hover:bg-primary-600/10 transition-all duration-300"})]}),e.jsxs("div",{className:"p-5 sm:p-6",children:[e.jsx("h3",{className:"font-semibold text-lg text-neutral-900 mb-2 line-clamp-2 min-h-[3.5rem] group-hover:text-primary-700 transition-colors",children:o.name}),e.jsx("p",{className:"text-neutral-600 text-sm mb-4 line-clamp-3 min-h-[4rem]",children:o.description}),e.jsx("div",{className:"mb-6",children:e.jsxs("div",{className:"flex items-baseline gap-2",children:[e.jsxs("span",{className:"text-2xl sm:text-3xl font-bold text-primary-600",children:["$",o.price.toLocaleString()]}),e.jsx("span",{className:"text-sm text-neutral-500",children:"COP"})]})}),E===0?e.jsx("button",{onClick:()=>l(o),disabled:S,className:`w-full ${S?"btn-outline opacity-50 cursor-not-allowed":"btn-primary"}`,children:S?e.jsxs(e.Fragment,{children:[e.jsx("svg",{className:"w-5 h-5 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M18.364 18.364A9 9 0 005.636 5.636m12.728 12.728L5.636 5.636m12.728 12.728L18.364 5.636M5.636 18.364l12.728-12.728"})}),"Agotado"]}):e.jsxs(e.Fragment,{children:[e.jsx("svg",{className:"w-5 h-5 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M3 3h2l.4 2M7 13h10l4-8H5.4m0 0L7 13m0 0l-1.1 5.6a1 1 0 001 1.4h9.2M7 13v6a1 1 0 001 1h8a1 1 0 001-1v-6m-9 1h10"})}),"Agregar al Carrito"]})}):e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between card p-3",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("button",{onClick:()=>g(o.id,E-1),className:"w-8 h-8 rounded-xl bg-neutral-100 hover:bg-neutral-200 border border-neutral-200 flex items-center justify-center transition-all hover:scale-105",children:e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M20 12H4"})})}),e.jsx("span",{className:"font-bold text-lg px-3 py-1 bg-primary-50 text-primary-700 rounded-lg border border-primary-200 min-w-[3rem] text-center",children:E}),e.jsx("button",{onClick:()=>g(o.id,E+1),disabled:E>=o.stock,className:`w-8 h-8 rounded-xl flex items-center justify-center transition-all hover:scale-105 ${E>=o.stock?"bg-neutral-100 text-neutral-400 cursor-not-allowed border border-neutral-200":"bg-primary-600 text-white hover:bg-primary-700 border border-primary-600"}`,children:e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4v16m8-8H4"})})})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-xs text-neutral-500",children:"Total"}),e.jsxs("p",{className:"font-bold text-primary-600",children:["$",(o.price*E).toLocaleString()]})]})]}),e.jsxs("button",{onClick:()=>h(o.id),className:"w-full text-error-600 hover:text-error-700 text-sm font-medium py-2 border border-error-200 rounded-xl hover:bg-error-50 transition-all flex items-center justify-center gap-2",children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})}),"Remover"]})]})]}),v&&e.jsx("div",{className:"px-5 pb-5",children:e.jsx("div",{className:"text-xs text-warning-700 bg-warning-100 rounded-xl px-3 py-2 text-center font-medium border border-warning-200",children:"âš ï¸ Â¡Quedan pocas unidades!"})})]},o.id)})}),a.length===0&&!i&&e.jsxs("div",{className:"text-center py-20 animate-slideUp",children:[e.jsx("div",{className:"text-8xl mb-8",children:"ðŸ›ï¸"}),e.jsx("h3",{className:"text-2xl font-semibold text-neutral-900 mb-4",children:"No hay productos disponibles"}),e.jsx("p",{className:"text-neutral-600 text-lg mb-8 max-w-md mx-auto",children:"Estamos preparando productos increÃ­bles para ti. Â¡Vuelve pronto!"}),e.jsxs("button",{onClick:()=>{T(R,null,function*(){try{d(!0);const p=yield le.getAllProducts();t(p)}catch(p){n(p.message)}finally{d(!1)}})},className:"btn-primary",children:[e.jsx("svg",{className:"w-5 h-5 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})}),"Recargar Productos"]})]})]}),e.jsx(dt,{})]})};class W{static initialize(){}static generateReference(){const r=Date.now(),a=Math.random().toString(36).substring(2,8);return`TX_${r}_${a}`}static blockWompiWidgets(){document.querySelectorAll('script[src*="wompi"], script[src*="checkout"]').forEach(m=>m.remove()),document.querySelectorAll('[id*="wompi"], [class*="wompi"], [data-wompi]').forEach(m=>m.remove());const t=document.createElement;document.createElement=function(m){var l;const n=t.call(this,m);if(m.toLowerCase()==="script"){const h=n,g=(l=Object.getOwnPropertyDescriptor(HTMLScriptElement.prototype,"src"))==null?void 0:l.set;g&&Object.defineProperty(h,"src",{set:function(f){f.includes("wompi")||f.includes("checkout.co")||g.call(this,f)},get:function(){return this.getAttribute("src")||""}})}return n};const i=window.fetch;window.fetch=function(...m){const n=m[0].toString();return n.includes("/widget")||n.includes("/v1/transactions")?Promise.reject(new Error("Widget bloqueado intencionalmente")):i.apply(this,m)},[{name:"wompi-disable-widget",content:"true"},{name:"wompi-form-only",content:"true"},{"http-equiv":"Content-Security-Policy",content:"script-src 'self' 'unsafe-inline'; object-src 'none';"}].forEach(m=>{const n=document.querySelector(`meta[name="${m.name}"], meta[http-equiv="${m["http-equiv"]}"]`);n&&n.remove();const l=document.createElement("meta");Object.entries(m).forEach(([h,g])=>{l.setAttribute(h,g)}),document.head.appendChild(l)})}static processPayment(r,a){return T(this,null,function*(){try{this.blockWompiWidgets();const t=this.generateReference(),i=Math.round(r*100),d={reference:t,amount_in_cents:i,currency:"COP"},m=yield fetch(`${this.BACKEND_URL}/api/payments/integrity`,{method:"POST",headers:{"Content-Type":"application/json","ngrok-skip-browser-warning":"true"},body:JSON.stringify(d)});if(!m.ok){const f=yield m.text();throw new Error(`Error al generar firma: ${m.status} - ${f}`)}const n=yield m.json(),l=document.createElement("form");l.method="GET",l.action=this.WOMPI_CHECKOUT_URL,l.target="_self",l.style.display="none";const h=[{name:"public-key",value:this.WOMPI_PUBLIC_KEY},{name:"currency",value:"COP"},{name:"amount-in-cents",value:i.toString()},{name:"reference",value:t},{name:"signature:integrity",value:n.integrity},{name:"customer-email",value:a},{name:"redirect-url",value:`${this.FRONTEND_URL}/payment-result`}];h.forEach(f=>{const o=document.createElement("input");o.type="hidden",o.name=f.name,o.value=f.value,l.appendChild(o)});const g=new URLSearchParams;return h.forEach(f=>{g.append(f.name,f.value)}),document.body.appendChild(l),setTimeout(()=>{l.submit()},2e3),{reference:t,amount_in_cents:i,integrity:n.integrity}}catch(t){throw t}})}static getTransactionStatus(r){return T(this,null,function*(){try{const a=yield fetch(`${this.BACKEND_URL}/api/payments/${r}`,{headers:{"ngrok-skip-browser-warning":"true"}});if(!a.ok){const i=new URLSearchParams(window.location.search),d=i.get("reference"),m=i.get("amount_in_cents"),n=i.get("customer-email"),l={reference:d||r,amount:m?(parseInt(m)/100).toString():"0",customer:{firstName:"Cliente",lastName:"Wompi",email:n||"test@wompi.co",phone:"3001234567"},delivery:null,cartItems:[],creditCard:null,paymentMethod:"CARD"},h=yield fetch(`${this.BACKEND_URL}/api/payments/create-transaction`,{method:"POST",headers:{"Content-Type":"application/json","ngrok-skip-browser-warning":"true"},body:JSON.stringify(l)});if(h.ok)return yield h.json();yield new Promise(f=>setTimeout(f,1e3));const g=yield fetch(`${this.BACKEND_URL}/api/payments/${r}`,{headers:{"ngrok-skip-browser-warning":"true"}});if(g.ok)return yield g.json();throw new Error(`TransacciÃ³n no encontrada: ${r}`)}return yield a.json()}catch(a){throw a}})}}V(W,"WOMPI_CHECKOUT_URL","https://checkout.co.uat.wompi.dev/p/"),V(W,"WOMPI_PUBLIC_KEY","pub_stagtest_g2u0HQd3ZMh05hsSgTS2lUV8t3s4mOt7"),V(W,"BACKEND_URL","https://back-pasarela.onrender.com"),V(W,"FRONTEND_URL","https://main.d10nqda7yg14nv.amplifyapp.com");const mt=()=>{var E;const s=B(),{cartItems:r,customer:a,creditCard:t,delivery:i,fees:d,cartTotal:m}=Q(v=>v.payment),[n,l]=b.useState(!1);b.useEffect(()=>{},[]);const h=()=>{s(ye())},g=()=>T(R,null,function*(){l(!0);try{const v=(d==null?void 0:d.baseFee)||0,S=(d==null?void 0:d.deliveryFee)||0,$=m+v+S,A=(a==null?void 0:a.email)||"cliente@test.com";W.initialize();const _=yield W.processPayment($,A),q={transactionId:_.reference,status:"pending",wompiTransactionId:"",reference:_.reference,amount:$};s(et(q))}catch(v){alert("Error al procesar el pago. Por favor intenta nuevamente."),l(!1)}});if(!r.length)return e.jsx("div",{className:"min-h-screen flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900 mb-2",children:"No hay productos en el carrito"}),e.jsx("button",{onClick:()=>s(J(1)),className:"text-blue-600 hover:text-blue-700",children:"Volver a productos"})]})});const f=(d==null?void 0:d.baseFee)||0,o=(d==null?void 0:d.deliveryFee)||0,p=m+f+o;return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 bg-neutral-900/60 backdrop-blur-sm z-40 animate-fadeIn"}),e.jsx("div",{className:"fixed inset-0 z-50 flex items-end justify-center",children:e.jsxs("div",{className:"w-full h-full flex flex-col",children:[e.jsx("div",{className:"flex-1 flex items-center justify-center p-6",children:e.jsxs("div",{className:"text-center text-white",children:[e.jsx("h1",{className:"text-3xl font-bold mb-2",children:"Resumen de Compra"}),e.jsx("p",{className:"text-neutral-300 text-lg",children:"Revisa tu pedido antes de continuar"})]})}),e.jsxs("div",{className:"bg-white rounded-t-3xl shadow-strong max-h-[70vh] overflow-hidden animate-slideUp flex flex-col",children:[e.jsxs("div",{className:"p-6 border-b border-neutral-200 flex-shrink-0",children:[e.jsx("div",{className:"w-12 h-1 bg-neutral-300 rounded-full mx-auto mb-4"}),e.jsx("h2",{className:"text-xl font-bold text-center",children:"Confirmar Pago"})]}),e.jsx("div",{className:"overflow-y-auto flex-1",children:e.jsxs("div",{className:"p-6 space-y-4",children:[e.jsxs("h3",{className:"font-semibold text-neutral-900 mb-4 flex items-center gap-2",children:[e.jsx("span",{className:"text-xl",children:"ðŸ›ï¸"}),"Tu Pedido"]}),e.jsx("div",{className:"space-y-3",children:r.map((v,S)=>e.jsxs("div",{className:"flex justify-between items-center p-4 bg-neutral-50 rounded-xl",style:{animationDelay:`${S*100}ms`},children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"font-medium text-neutral-900",children:v.product.name}),e.jsxs("p",{className:"text-sm text-neutral-600",children:["$",v.product.price.toFixed(2)," x ",v.quantity]})]}),e.jsx("div",{className:"text-right",children:e.jsxs("p",{className:"font-semibold text-neutral-900",children:["$",(v.product.price*v.quantity).toFixed(2)]})})]},v.product.id))}),e.jsxs("div",{className:"mt-6 p-4 bg-neutral-50 rounded-xl space-y-3",children:[e.jsxs("h3",{className:"font-semibold text-neutral-900 flex items-center gap-2",children:[e.jsx("span",{className:"text-xl",children:"ðŸ’°"}),"Desglose de Costos"]}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-neutral-600",children:"Subtotal productos:"}),e.jsxs("span",{className:"font-medium",children:["$",m.toFixed(2)]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-neutral-600",children:"Tarifa base:"}),e.jsxs("span",{className:"font-medium",children:["$",f.toFixed(2)]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-neutral-600",children:"Costo de envÃ­o:"}),e.jsxs("span",{className:"font-medium",children:["$",o.toFixed(2)]})]}),e.jsxs("div",{className:"border-t pt-2 flex justify-between text-lg font-bold",children:[e.jsx("span",{children:"Total a pagar:"}),e.jsxs("span",{className:"text-primary-600",children:["$",p.toFixed(2)," COP"]})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mt-6",children:[e.jsxs("div",{className:"p-4 bg-neutral-50 rounded-xl",children:[e.jsxs("h3",{className:"font-semibold text-neutral-900 mb-3 flex items-center gap-2",children:[e.jsx("span",{className:"text-xl",children:"ðŸ‘¤"}),"InformaciÃ³n del Cliente"]}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-neutral-600",children:"Nombre:"}),e.jsxs("span",{className:"font-medium",children:[a==null?void 0:a.firstName," ",a==null?void 0:a.lastName]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-neutral-600",children:"Email:"}),e.jsx("span",{className:"font-medium",children:a==null?void 0:a.email})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-neutral-600",children:"TelÃ©fono:"}),e.jsx("span",{className:"font-medium",children:a==null?void 0:a.phone})]})]})]}),e.jsxs("div",{className:"p-4 bg-neutral-50 rounded-xl",children:[e.jsxs("h3",{className:"font-semibold text-neutral-900 mb-3 flex items-center gap-2",children:[e.jsx("span",{className:"text-xl",children:"ðŸ’³"}),"InformaciÃ³n de Pago"]}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-neutral-600",children:"Tarjeta:"}),e.jsxs("span",{className:"font-medium",children:["****",((E=t==null?void 0:t.cardNumber)==null?void 0:E.slice(-4))||"****"]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-neutral-600",children:"Titular:"}),e.jsx("span",{className:"font-medium",children:(t==null?void 0:t.cardHolder)||"N/A"})]})]})]}),e.jsxs("div",{className:"p-4 bg-neutral-50 rounded-xl md:col-span-2",children:[e.jsxs("h3",{className:"font-semibold text-neutral-900 mb-3 flex items-center gap-2",children:[e.jsx("span",{className:"text-xl",children:"ðŸšš"}),"InformaciÃ³n de Entrega"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-neutral-600",children:"DirecciÃ³n:"}),e.jsx("span",{className:"font-medium",children:(i==null?void 0:i.address)||"N/A"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-neutral-600",children:"Ciudad:"}),e.jsx("span",{className:"font-medium",children:(i==null?void 0:i.city)||"N/A"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-neutral-600",children:"Departamento:"}),e.jsx("span",{className:"font-medium",children:(i==null?void 0:i.department)||"N/A"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-neutral-600",children:"CÃ³digo postal:"}),e.jsx("span",{className:"font-medium",children:(i==null?void 0:i.postalCode)||"N/A"})]})]})]})]})]})]})}),e.jsxs("div",{className:"p-6 bg-white border-t border-neutral-200 flex-shrink-0 space-y-4",children:[e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:h,className:"flex-1 py-4 px-6 bg-neutral-100 text-neutral-700 rounded-xl font-semibold hover:bg-neutral-200 transition-colors",children:"Nuevo Pago"}),e.jsx("button",{onClick:g,disabled:n,className:"flex-2 py-4 px-8 bg-primary-600 text-white rounded-xl font-semibold hover:bg-primary-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors flex items-center justify-center gap-2",children:n?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-5 h-5 border-2 border-white border-t-transparent rounded-full animate-spin"}),"Procesando..."]}):`Pagar $${p.toFixed(2)} COP`})]}),e.jsxs("div",{className:"text-center text-xs text-neutral-500 flex items-center justify-center gap-2",children:[e.jsx("span",{className:"text-green-600",children:"ðŸ”’"}),"Pago seguro con Wompi - Todos tus datos estÃ¡n protegidos"]})]})]})]})})]})},ut=()=>{const s=B(),{currentStep:r,cartItems:a}=Q(n=>n.payment);b.useEffect(()=>{a.length===0&&r>1&&s(J(1))},[a.length,r,s]);const t=(n,l,h)=>l?e.jsx("div",{className:"w-8 h-8 bg-success-500 text-white rounded-full flex items-center justify-center shadow-soft",children:e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})})}):h?e.jsx("div",{className:"w-8 h-8 bg-primary-600 text-white rounded-full flex items-center justify-center shadow-soft animate-pulse-slow",children:e.jsx("span",{className:"text-sm font-bold",children:n})}):e.jsx("div",{className:"w-8 h-8 bg-neutral-300 text-neutral-600 rounded-full flex items-center justify-center",children:e.jsx("span",{className:"text-sm font-medium",children:n})}),i=[{number:1,title:"Productos",description:"Selecciona y compra"},{number:2,title:"Pagar",description:"Confirmar con Wompi"}],d=()=>e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-primary-100 via-primary-50 to-transparent opacity-30 rounded-3xl blur-xl"}),e.jsx("div",{className:"relative bg-white/80 backdrop-blur-sm rounded-3xl p-6 shadow-soft border border-white/20",children:e.jsx("div",{className:"flex items-center justify-between",children:i.map((n,l)=>{const h=r>n.number,g=r===n.number;return e.jsxs("div",{className:"flex items-center",children:[e.jsxs("div",{className:"flex flex-col items-center",children:[t(n.number,h,g),e.jsxs("div",{className:"mt-2 text-center",children:[e.jsx("div",{className:`text-sm font-medium ${g?"text-primary-700":h?"text-success-700":"text-neutral-500"}`,children:n.title}),e.jsx("div",{className:"text-xs text-neutral-500 hidden sm:block",children:n.description})]})]}),l<i.length-1&&e.jsx("div",{className:`flex-1 h-0.5 mx-4 ${h?"bg-success-300":"bg-neutral-200"} transition-colors duration-300`})]},n.number)})})})]}),m=()=>{switch(r){case 1:return e.jsx(he,{});case 2:return e.jsx(mt,{});default:return e.jsx(he,{})}};return e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-neutral-50 via-white to-primary-50/30 relative overflow-hidden",children:[e.jsxs("div",{className:"absolute inset-0 opacity-30",children:[e.jsx("div",{className:"absolute top-20 left-10 w-72 h-72 bg-gradient-to-br from-primary-200 to-primary-300 rounded-full mix-blend-multiply filter blur-xl animate-blob"}),e.jsx("div",{className:"absolute top-40 right-10 w-72 h-72 bg-gradient-to-br from-purple-200 to-pink-300 rounded-full mix-blend-multiply filter blur-xl animate-blob animation-delay-2000"}),e.jsx("div",{className:"absolute -bottom-8 left-20 w-72 h-72 bg-gradient-to-br from-yellow-200 to-orange-300 rounded-full mix-blend-multiply filter blur-xl animate-blob animation-delay-4000"})]}),e.jsx("div",{className:"relative z-10",children:e.jsxs("div",{className:"container mx-auto px-4 py-8",children:[d(),e.jsx("div",{className:"mt-8",children:m()})]})})]})},xt=()=>{const s=$e(),r=qe(),a=B(),t=_e(),[i,d]=b.useState(!0),[m,n]=b.useState(null),[l,h]=b.useState(null),[g,f]=b.useState(!1),o=b.useRef(0),p=b.useRef(null),E=3e3,v=8e3,[S,$]=b.useState("Esperando confirmaciÃ³n de Wompi..."),A=new URLSearchParams(s.search),_=A.get("id"),q=A.get("reference"),c=x=>(x==null?void 0:x.map(w=>({product:{id:parseInt(w.product.id.toString()),name:w.product.name,description:w.product.description,price:parseFloat(w.product.price.toString()),stock:w.product.stock},quantity:w.quantity})))||[],u=b.useCallback(()=>T(R,null,function*(){var x,w,O,me;try{const M=q||_;if(!M)return n("ERROR_NO_REFERENCE"),"ERROR_NO_REFERENCE";const ee=yield fetch(`https://back-pasarela.onrender.com/api/payments/${M}`,{headers:{"ngrok-skip-browser-warning":"true"}});if(!ee.ok){if(ee.status===404){try{const k=yield fetch(`https://back-pasarela.onrender.com/api/payments/${M}/check-wompi`,{headers:{"ngrok-skip-browser-warning":"true"}});if(k.ok){const j=yield k.json();if(j.success&&j.data)return h({id:Date.now(),reference:M,amount:j.data.amount_in_cents/100,status:F(j.data.status),createdAt:j.data.created_at,updatedAt:j.data.updated_at||j.data.created_at,paymentMethod:"Tarjeta de CrÃ©dito",paymentToken:j.data.id,wompiTransactionId:j.data.id,cartItems:c(t.getState().payment.cartItems),totalItems:((x=t.getState().payment.cartItems)==null?void 0:x.reduce((te,se)=>te+se.quantity,0))||0,deliveryInfo:t.getState().payment.delivery,customer:Z(),product:X()}),n(F(j.data.status)),F(j.data.status)}}catch(k){}const N=t.getState(),C=A.get("amount_in_cents")?parseInt(A.get("amount_in_cents"))/100:0,y=C>0?C:N.payment.cartTotal,G={reference:M,amount:y.toString(),customer:N.payment.customer||{firstName:"Cliente",lastName:"Wompi",email:A.get("customer-email")||"no-email@example.com",phone:"0000000000"},delivery:N.payment.delivery||null,cartItems:N.payment.cartItems||[],creditCard:N.payment.creditCard||null,paymentMethod:A.get("payment_method_type")||"CARD"},H=yield fetch("https://back-pasarela.onrender.com/api/payments/create-transaction",{method:"POST",headers:{"Content-Type":"application/json","ngrok-skip-browser-warning":"true"},body:JSON.stringify(G)});if(H.ok){const k=yield H.json();if(k.success){const j=t.getState();return h({id:k.data.id,reference:k.data.reference||M,amount:y,status:k.data.status,createdAt:k.data.createdAt,updatedAt:k.data.updatedAt,paymentMethod:k.data.paymentMethod||"Tarjeta de CrÃ©dito",paymentToken:k.data.paymentToken,cartItems:c(j.payment.cartItems),totalItems:((w=j.payment.cartItems)==null?void 0:w.reduce((te,se)=>te+se.quantity,0))||0,deliveryInfo:j.payment.delivery,customer:j.payment.customer?{id:0,firstName:j.payment.customer.firstName,lastName:j.payment.customer.lastName,email:j.payment.customer.email,phone:j.payment.customer.phone,documentType:"",documentNumber:""}:void 0,product:(me=(O=j.payment.cartItems)==null?void 0:O[0])!=null&&me.product?{id:parseInt(j.payment.cartItems[0].product.id.toString()),name:j.payment.cartItems[0].product.name,description:j.payment.cartItems[0].product.description,price:parseFloat(j.payment.cartItems[0].product.price.toString()),stock:j.payment.cartItems[0].product.stock}:void 0,wompiTransactionId:k.data.wompiTransactionId}),n(k.data.status),k.data.status}}}return n("ERROR_CONSULTA"),"ERROR_CONSULTA"}const D=yield ee.json();if(D.success&&D.data){const N=D.data,C=t.getState();return h(y=>{var G,H;return{id:N.id,reference:N.reference||M,amount:N.amount>0?N.amount:(y==null?void 0:y.amount)||C.payment.cartTotal,status:N.status,createdAt:N.createdAt,updatedAt:N.updatedAt,paymentMethod:N.paymentMethod||"Tarjeta de CrÃ©dito",paymentToken:N.paymentToken,cartItems:N.cartItems||(y==null?void 0:y.cartItems)||c(C.payment.cartItems||[]),totalItems:N.totalItems||(y==null?void 0:y.totalItems)||(N.cartItems?N.cartItems.reduce((k,j)=>k+j.quantity,0):0),deliveryInfo:N.deliveryInfo||(y==null?void 0:y.deliveryInfo)||C.payment.delivery,customer:N.customer||(y==null?void 0:y.customer)||(C.payment.customer?{id:0,firstName:C.payment.customer.firstName,lastName:C.payment.customer.lastName,email:C.payment.customer.email,phone:C.payment.customer.phone,documentType:"",documentNumber:""}:void 0),product:N.product||(y==null?void 0:y.product)||((H=(G=C.payment.cartItems)==null?void 0:G[0])!=null&&H.product?{id:parseInt(C.payment.cartItems[0].product.id.toString()),name:C.payment.cartItems[0].product.name,description:C.payment.cartItems[0].product.description,price:parseFloat(C.payment.cartItems[0].product.price.toString()),stock:C.payment.cartItems[0].product.stock}:void 0),wompiTransactionId:N.wompiTransactionId||(y==null?void 0:y.wompiTransactionId)}}),n(N.status),N.status}else return n((D==null?void 0:D.status)||"ERROR_CONSULTA"),(D==null?void 0:D.status)||"ERROR_CONSULTA"}catch(M){return n("ERROR_NETWORK"),"ERROR_NETWORK"}}),[q,_,t]),F=x=>({APPROVED:"APPROVED",PENDING:"PENDING",DECLINED:"DECLINED",VOIDED:"FAILED",ERROR:"FAILED",FAILED:"FAILED"})[x]||"PENDING",Z=()=>{const x=t.getState();return x.payment.customer?{id:0,firstName:x.payment.customer.firstName,lastName:x.payment.customer.lastName,email:x.payment.customer.email,phone:x.payment.customer.phone,documentType:"",documentNumber:""}:void 0},X=()=>{var w,O;const x=t.getState();return(O=(w=x.payment.cartItems)==null?void 0:w[0])!=null&&O.product?{id:parseInt(x.payment.cartItems[0].product.id.toString()),name:x.payment.cartItems[0].product.name,description:x.payment.cartItems[0].product.description,price:parseFloat(x.payment.cartItems[0].product.price.toString()),stock:x.payment.cartItems[0].product.stock}:void 0};b.useEffect(()=>{let x=!0;o.current===0&&d(!0);const w=()=>T(R,null,function*(){p.current&&window.clearTimeout(p.current),o.current+=1,o.current%15===0&&$(`AÃºn esperando confirmaciÃ³n de Wompi... (${Math.floor(o.current/7.5)} minutos)`),x&&f(!0);const O=yield u();x&&(i&&d(!1),O==="PENDING"||O==="PROCESSING"?p.current=window.setTimeout(w,v):f(!1))});return o.current=0,p.current=window.setTimeout(w,E),()=>{x=!1,p.current&&window.clearTimeout(p.current),f(!1)}},[u,i]);const z=x=>typeof x!="number"||isNaN(x)?"$ 0":new Intl.NumberFormat("es-CO",{style:"currency",currency:"COP",minimumFractionDigits:0,maximumFractionDigits:0}).format(x),we=()=>{switch(m){case"COMPLETED":case"APPROVED":return{icon:"âœ…",title:"Â¡Pago Exitoso!",message:"Tu compra ha sido procesada correctamente.",color:"text-green-600",bgColor:"bg-green-50",borderColor:"border-green-200"};case"PENDING":case"PROCESSING":return{icon:"â°",title:"Pago en Proceso",message:"Tu pago estÃ¡ siendo procesado. Te notificaremos cuando se complete.",color:"text-yellow-600",bgColor:"bg-yellow-50",borderColor:"border-yellow-200"};case"FAILED":case"REJECTED":case"DECLINED":return{icon:"âŒ",title:"Pago Rechazado",message:"Tu pago fue rechazado. Por favor, intenta con otro mÃ©todo o contacta a tu banco.",color:"text-red-600",bgColor:"bg-red-50",borderColor:"border-red-200"};default:return{icon:"â“",title:"Estado del Pago",message:`No se pudo confirmar el estado final de tu pago. Referencia: ${q||_}. Contacta a soporte si el problema persiste.`,color:"text-red-600",bgColor:"bg-red-50",borderColor:"border-red-200"}}},de=()=>{a(ye()),a(J(1)),r("/")},Ce=()=>T(R,null,function*(){if(l!=null&&l.reference)try{f(!0);const x={data:{transaction:{id:`${l.reference}-APPROVED`,reference:l.reference,amount_in_cents:Math.round(l.amount*100),status:"APPROVED",payment_method_type:"CARD"}},event:"transaction.updated",signature:{checksum:"test-simulation"}};(yield fetch("https://back-pasarela.onrender.com/api/payments/webhook",{method:"POST",headers:{"Content-Type":"application/json","ngrok-skip-browser-warning":"true"},body:JSON.stringify(x)})).ok?setTimeout(()=>T(R,null,function*(){const O=yield u();f(!1)}),2e3):f(!1)}catch(x){f(!1)}});if(i&&!l)return e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-100",children:e.jsxs("div",{className:"p-8 bg-white rounded-lg shadow-lg text-center max-w-md w-full mx-4",children:[e.jsx("div",{className:"animate-spin w-16 h-16 border-4 border-blue-500 border-t-transparent rounded-full mx-auto mb-4"}),e.jsx("h2",{className:"text-xl font-semibold text-gray-800 mb-2",children:"Verificando tu pago..."}),e.jsx("p",{className:"text-gray-600",children:"Por favor espera mientras confirmamos el estado de tu transacciÃ³n."})]})});const L=we();return!l&&!i&&m!=="PENDING"&&m!=="APPROVED"?e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-100 p-4",children:e.jsxs("div",{className:"max-w-md w-full bg-white shadow-xl rounded-lg p-8 text-center",children:[e.jsx("div",{className:"text-6xl mb-4",children:L.icon}),e.jsx("h2",{className:`text-2xl font-bold ${L.color} mb-4`,children:L.title}),e.jsx("p",{className:"text-gray-600 mb-6",children:L.message}),e.jsx("button",{onClick:de,className:"w-full px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors font-semibold",children:"Volver a la Tienda"})]})}):e.jsx("div",{className:"min-h-screen bg-gray-100 py-8 px-4",children:e.jsx("div",{className:"max-w-3xl mx-auto",children:e.jsxs("div",{className:"bg-white shadow-xl rounded-lg overflow-hidden",children:[e.jsxs("div",{className:`p-6 text-center border-b ${L.bgColor} ${L.borderColor}`,children:[e.jsxs("div",{className:"flex justify-center items-center mb-4",children:[e.jsx("div",{className:"text-6xl",children:L.icon}),g&&m==="PENDING"&&e.jsx("div",{className:"ml-4 animate-spin w-8 h-8 border-4 border-yellow-500 border-t-transparent rounded-full"})]}),e.jsx("h1",{className:`text-3xl font-bold ${L.color} mb-2`,children:L.title}),e.jsx("p",{className:"text-gray-600 text-lg",children:L.message}),g&&m==="PENDING"&&e.jsx("p",{className:"mt-3 text-sm text-yellow-600 font-medium",children:S})]}),l&&e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"mb-8",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4 flex items-center",children:"ðŸ“„ InformaciÃ³n de la TransacciÃ³n"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 p-4 bg-gray-50 rounded-lg",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Referencia"}),e.jsx("p",{className:"font-semibold text-gray-900",children:l.reference})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"ID Wompi"}),e.jsx("p",{className:"font-semibold text-gray-900",children:l.wompiTransactionId||"N/A"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Fecha y Hora"}),e.jsx("p",{className:"font-semibold text-gray-900",children:l.createdAt?new Date(l.createdAt).toLocaleString("es-CO"):"N/A"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"MÃ©todo de Pago"}),e.jsx("p",{className:"font-semibold text-gray-900",children:l.paymentMethod})]})]})]}),l.customer&&e.jsxs("div",{className:"mb-8",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4 flex items-center",children:"ðŸ‘¤ InformaciÃ³n del Cliente"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 p-4 bg-blue-50 rounded-lg",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Nombre"}),e.jsxs("p",{className:"font-semibold text-gray-900",children:[l.customer.firstName," ",l.customer.lastName]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Email"}),e.jsx("p",{className:"font-semibold text-gray-900",children:l.customer.email})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"TelÃ©fono"}),e.jsx("p",{className:"font-semibold text-gray-900",children:l.customer.phone})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Documento"}),e.jsxs("p",{className:"font-semibold text-gray-900",children:[l.customer.documentType," ",l.customer.documentNumber]})]})]})]}),l.cartItems&&l.cartItems.length>0?e.jsxs("div",{className:"mb-8",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 mb-4 flex items-center",children:["ðŸ›ï¸ Productos Comprados (",l.totalItems||l.cartItems.length," items)"]}),e.jsx("div",{className:"space-y-4",children:l.cartItems.map((x,w)=>e.jsx("div",{className:"p-4 bg-green-50 rounded-lg",children:e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"font-semibold text-gray-900 text-lg",children:x.product.name}),e.jsx("p",{className:"text-gray-600 mt-1",children:x.product.description}),e.jsxs("p",{className:"text-sm text-gray-500 mt-2",children:["Cantidad: ",x.quantity," Ã— ",z(x.product.price)]})]}),e.jsx("div",{className:"text-right ml-4",children:e.jsx("p",{className:"text-xl font-bold text-green-600",children:z(x.product.price*x.quantity)})})]})},w))})]}):l.product&&e.jsxs("div",{className:"mb-8",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4 flex items-center",children:"ðŸ›ï¸ Producto Comprado"}),e.jsx("div",{className:"p-4 bg-green-50 rounded-lg",children:e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"font-semibold text-gray-900 text-lg",children:l.product.name}),e.jsx("p",{className:"text-gray-600 mt-1",children:l.product.description}),e.jsx("p",{className:"text-sm text-gray-500 mt-2",children:"Cantidad: 1"})]}),e.jsx("div",{className:"text-right ml-4",children:e.jsx("p",{className:"text-2xl font-bold text-green-600",children:z(l.product.price)})})]})})]}),l.deliveryInfo&&e.jsxs("div",{className:"mb-8",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4 flex items-center",children:"ðŸšš InformaciÃ³n de Entrega"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 p-4 bg-blue-50 rounded-lg",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Destinatario"}),e.jsx("p",{className:"font-semibold text-gray-900",children:l.deliveryInfo.recipientName})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"TelÃ©fono"}),e.jsx("p",{className:"font-semibold text-gray-900",children:l.deliveryInfo.recipientPhone})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("p",{className:"text-sm text-gray-600",children:"DirecciÃ³n"}),e.jsxs("p",{className:"font-semibold text-gray-900",children:[l.deliveryInfo.address,", ",l.deliveryInfo.city,", ",l.deliveryInfo.department," - ",l.deliveryInfo.postalCode]})]})]})]}),e.jsx("div",{className:"border-t pt-6",children:e.jsxs("div",{className:"flex justify-between items-center text-2xl font-bold",children:[e.jsx("span",{className:"text-gray-700",children:"TOTAL PAGADO:"}),e.jsx("span",{className:"text-blue-600",children:z(l.amount)})]})})]}),e.jsxs("div",{className:"px-6 py-4 bg-gray-50 border-t flex flex-col gap-3 items-center",children:[e.jsx("button",{onClick:de,className:"px-8 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors font-semibold",children:"Volver a la Tienda"}),l&&m==="PENDING"&&e.jsx("button",{onClick:Ce,disabled:g,className:"px-6 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors font-medium text-sm disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2",children:g?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin w-4 h-4 border-2 border-white border-t-transparent rounded-full"}),"Procesando..."]}):e.jsx(e.Fragment,{children:"ðŸŽ¯ Simular AprobaciÃ³n (Testing)"})})]})]})})})},pt=()=>e.jsx(Ue,{children:e.jsx("div",{className:"App",children:e.jsxs(We,{children:[e.jsx(ae,{path:"/",element:e.jsx(ut,{})}),e.jsx(ae,{path:"/payment-result",element:e.jsx(xt,{})}),e.jsx(ae,{path:"*",element:e.jsx(Be,{to:"/",replace:!0})})]})})}),ht=document.getElementById("root"),ft=je(ht);ft.render(e.jsx(Le.StrictMode,{children:e.jsx(Me,{store:ce,children:e.jsx(pt,{})})}))});export default gt();
